#!/bin/bash

# Fitness App - Git Post-Receive Hook
# This script is triggered when you push to the production git repository
# Place this file at: /home/deploy/fitness.git/hooks/post-receive
# Make it executable: chmod +x /home/deploy/fitness.git/hooks/post-receive

set -e

# Read the push information
while read oldrev newrev refname; do
    # Only deploy on push to main branch
    if [[ $refname == "refs/heads/main" ]]; then
        echo "ğŸš€ Received push to main branch"
        echo "ğŸ“ Old revision: $oldrev"
        echo "ğŸ“ New revision: $newrev"

        # Run the deployment script
        echo "ğŸƒâ€â™‚ï¸ Starting deployment..."
        /home/deploy/fitness-rr/deploy/deploy.sh

        if [ $? -eq 0 ]; then
            echo "âœ… Deployment completed successfully!"
        else
            echo "âŒ Deployment failed!"
            exit 1
        fi
    else
        echo "â„¹ï¸  Push to $refname ignored (only main branch triggers deployment)"
    fi
done
